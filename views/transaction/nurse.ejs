<%- include('../layouts/partials/messages.ejs') %>
    <div class="container">
        <div class="row" style="margin-top: 20px">
            <div class="col-md-6 mx-auto">
                <div class="card card-body shadow">
                    <h2 class="text-center mb-3"><i class="bi bi-box-arrow-in-right"></i> &nbsp; Nurse Notes </h2>
                    <form class="needs-validation" method="POST" novalidate id="demo">
                        <div class="mt-2">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input autofocus type="text" id="id" name="id" class="form-control"
                                            value="<%= typeof id != 'undefined' ? id : '' %>" hidden />
                                        <select class="form-select mb-2" id="patient_id" name="patient_id"
                                            onchange="showPrescriptionForm()" required>
                                            <option selected disabled value="">select</option>
                                            <% patientTypes.forEach(function(type) {if (type.isActive===1) {%>
                                                <option value="<%= type.id %>" <%=selectedPatientType==type.id
                                                    ? 'selected' : '' %>>
                                                    <%= type.patient_name %>
                                                </option>
                                                <% }}) %>
                                        </select>
                                        <label for="patient_id">Patient Id:</label>
                                        <div class="invalid-feedback">patient type is required</div>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <select class="form-select mb-2" id="staff_id" name="staff_id" required>
                                            <option selected disabled value="">select</option>
                                            <% staffTypes.forEach(function(type) {if (type.isActive===1) { %>
                                                <option value="<%= type.id %>" <%=selectedstaffTypes==type.id
                                                    ? 'selected' : '' %>><%= type.first_name %>
                                                </option>
                                                <% }}) %>
                                        </select>
                                        <label for="staff_id">Staff Id:</label>
                                        <div class="invalid-feedback">Staff Id is required</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="datetime-local" class="form-control" name="nurse_date"
                                            id="nurse_date" <% if (typeof rows?.nurse_date !='undefined' &&
                                            rows.nurse_date !==null) { %>
                                        value="<%= moment(rows.nurse_date).format('YYYY-MM-DDTHH:mm:ss') %>"
                                            <% } else { %>
                                                value="<%= new Date().toISOString().substr(0, 16) %>"
                                                    <% } %>
                                                        max="<%= new Date().toISOString().substr(0, 16) %>" >
                                                            <label for="nurse_date">Nurse Date:</label>
                                                            <div class="invalid-feedback">Please fill date..</div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="row g-2 mt-2">


                            <div class="col-md-12">
                                <div class="form-floating">

                                    <textarea class="form-control" name="nurse_notes"
                                        placeholder="Please Fill your address" id="nurse_notes" maxlength="500"
                                        style="min-height: 100px;" required
                                        style="min-height:100px"><%= typeof rows?.nurse_notes != 'undefined' ? rows?.nurse_notes : '' %></textarea>
                                    <label for="nurse_notes">Nurse Notes:</label>
                                    <div class="invalid-feedback">Nurse Notes is required</div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-block bg-primary" name="action"
                                value="save">Save</button>
                            <button type="reset" class="btn btn-block bg-warning">Clear</button>
                            <a href="javascript:history.back()" type="submit" class="btn btn-secondary">Back</a>


                        </div>
                    </form>
                </div>
            </div>


            <div class="col-md-6 mx-auto" id="prescription-form" style="display:none;">
                <div class="card card-body shadow">
                    <h2 class="text-center mb-3"><i class="bi bi-box-arrow-in-right"></i> &nbsp; Prescriptions </h2>
                    <div class="needs-validation" novalidate id="demo">
                        <div class="mt-2">
                            <% if (getPrescription.length> 0) { %>
                                <div class="accordion" id="accordionPanelsStayOpenExample">
                                    <% getPrescription.forEach(function(data) { %>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                                    data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
                                                    aria-controls="panelsStayOpen-collapseOne">
                                                    <%= data.note_date %>
                                                </button>
                                            </h2>
                                            <div id="panelsStayOpen-collapseOne"
                                                class="accordion-collapse collapse show"
                                                aria-labelledby="panelsStayOpen-headingOne">
                                                <div class="accordion-body">
                                                    <strong>Medication</strong>
                                                    <ul>
                                                        <li>
                                                            <%= data.medication_name %>
                                                        </li>
                                                    </ul>
                                                    <strong>Symptoms</strong>
                                                    <ul>
                                                        <li>
                                                            <%= data.symptom_name %>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <% }) %>
                                </div>
                                <% }else{ %>


                                    <p class="text-center">No Patient prescription available </p>

                                    <%}%>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <script>
        // function showPrescriptionForm() {
        //     // Get the selected value of the patient name dropdown
        //     var selectedPatientName = document.getElementById('patient_id').value;

        //     // If the selected value is not empty, show the second form
        //     if (selectedPatientName !== '') {
        //         document.getElementById('prescription-form').style.display = 'block';
        //         // Set the selected patient name in the prescription form
        //         document.getElementById('patient_name').value = selectedPatientName;
        //     } else {
        //         // Otherwise, hide the second form
        //         document.getElementById('prescription-form').style.display = 'none';
        //     }
        // }



        // function showPrescriptionForm() {
        //     const select = document.getElementById('patient_id');
        //     const selectedIndex = select.selectedIndex;
        //     const selectedOption = select.options[selectedIndex];
        //     const selectedValue = selectedOption.value;

        //     // Hide all prescription forms
        //     const prescriptionForms = document.querySelectorAll('#prescription-form');
        //     prescriptionForms.forEach(form => form.style.display = 'none');

        //     // Show the prescription form for the selected date
        //     const selectedPrescriptionForm = document.querySelector(`#prescription-form-${selectedValue}`);
        //     selectedPrescriptionForm.style.display = 'block';
        // }

        function showPrescriptionForm() {
            const patientId = document.getElementById('patient_id').value;
            const prescriptionForm = document.getElementById('prescription-form');

            if (patientId) {
                prescriptionForm.style.display = 'block';
            } else {
                prescriptionForm.style.display = 'none';
            }
        }


    </script>